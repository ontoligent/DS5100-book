<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DS 5100: Programming for Data Science - NB: Dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../modules/m12/m12-intro.html" rel="next">
<link href="../../notebooks/M11_RDplyr/M11-01-Tibbles.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../modules/m11/m11-intro.html">M11 Dplyr</a></li><li class="breadcrumb-item"><a href="../../notebooks/M11_RDplyr/M11-02-Dplyr.html"><span class="chapter-title">NB: Dplyr</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">DS 5100: Programming for Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ontoligent/DS5100-book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../modules/m00/m00-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../video-gallery.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Video Gallery</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m01/m01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M01 Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/rivanna.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">About Rivanna</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/unix.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Using Unix</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/setting-up-ssh.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">SSH for GitHub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/git-and-github.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Git and GitHub</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m02/m02-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M02 Introducing Python</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/on-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data and Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/python-object-types.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Python Object Types</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M02_BasicPython/M02-01-DataTypes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Data Types, Operators, and Expressions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M02_BasicPython/M02-02-Numbers.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Numbers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M02_BasicPython/M02-03-Booleans.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Booleans</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M02_BasicPython/M02-04-Strings.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Strings</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M02_BasicPython/M02-05-Structures.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Data Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M02_BasicPython/M02-06-AsideOnImmutables.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Aside On Immutables</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m03/m03-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M03 Control Structures</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/vals-vars-expressions-statements.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Values, Variables, Expressions, and Statements</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M03_ControlStructures/M03-01-ControlStructures.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Control Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M03_ControlStructures/M03-02-IterablesAndIterators.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Iterables and Iterators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M03_ControlStructures/M03-03-Comprehensions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Comprehensions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M03_ControlStructures/M03-04-NestedComprehensions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Nested Comprehensions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m04/m04-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M04 Functions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M04_PythonFunctions/M04-01-Functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Introduction to Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M04_PythonFunctions/M04-02-Importing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Importing Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M04_PythonFunctions/M04-03-LambdaFunctions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Lambda Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M04_PythonFunctions/M04-04-RecursiveFunctions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Recursion</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M04_PythonFunctions/M04-05-Scope.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Scope</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M04_PythonFunctions/M04-06-FunctionsCallingFunctions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Function Groups</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m05/m05-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M05 NumPy</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M05_NumPy/M05-00-Time.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Python Timing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M05_NumPy/M05-01-BasicFileIO.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Basic File I/O</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M05_NumPy/M05-02-NumpyDesign.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Introducing NumPy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M05_NumPy/M05-03-NumPyIndexing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: NumPy Indexing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M05_NumPy/M05-04-NumPyOperating.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: NumPy Operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M05_NumPy/M05-05-NumPyFunctions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: NumPy Functions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m06/m06-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M06 Pandas</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M06_Pandas/M06-00-IntroducingPandas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Introducting Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M06_Pandas/M06-01-ExploringPandas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Exploring Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M06_Pandas/M06-02-DeeperIntoPandas.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Deeper Into Pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M06_Pandas/M06-03-NarrowWide.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Narrow vs Wide Tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M06_Pandas/M06-04-MethodChaining.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Method Chaining</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M06_Pandas/M06-05-Pandas-and-SQL.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Pandas and SQL</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m07/m07-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M07 Classes</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/what-is-oop.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">What is OOP?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M07_PythonClasses/M07-01-Classes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Introducing Classes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M07_PythonClasses/M07-02-ClassesExample.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: From Functions to Classes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M07_PythonClasses/M07-03-MoreOnClasses.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: More About Classes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M07_PythonClasses/M07-04-ClassAttributeWeirdness.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Understanding Class Attributes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M07_PythonClasses/M07-05-Example.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Putting Your Class in a File</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m08/m08-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M08 Testing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M08_PythonTesting/M08-00-TestingAndVerification.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Testing and Verification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M08_PythonTesting/M08-01-ExceptionHandling.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Exception Handling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M08_PythonTesting/M08-02-PythonUnitTesting.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Unit Testing with Unittest</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m09/m09-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M09 Modules</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M09_PythonModules/M09-01-ModulesAndPackages.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Modules and Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M09_PythonModules/M09-02-Namespaces.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Namespaces and Paths</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M09_PythonModules/M09-03-MakingYourOwn.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: User-Created Packages</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m10/m10-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M10 Basic R</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M10_RBasics/M10-01-Intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Introducing R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M10_RBasics/M10-02-DataTypes.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: R Data Types and Operators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M10_RBasics/M10-03-DataStructures.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: R Data Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M10_RBasics/M10-04-DataFrames.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: R Data Frames</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M10_RBasics/M10-05-ControlStructures.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: R Control Structures</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M10_RBasics/M10-06-Functions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: R Functions</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m11/m11-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M11 Dplyr</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M11_RDplyr/M11-01-Tibbles.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: The Tidyverse and Tibbles</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M11_RDplyr/M11-02-Dplyr.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">NB: Dplyr</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m12/m12-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M12 Visualization</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M12_RViz/M12-00-AGrammarOfGraphics.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">GGPlot and the Grammar of Graphics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M12_RViz/M12-01-GettingStartedWithGGPlot.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Getting Started with GGPlot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M12_RViz/M12-02-RMarkdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB R Markdown</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M12_RViz/M12-03-Qplot-and-Plotly.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: Plotly and GGPlotly</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M12_RViz/M12-04-Plotnine.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">NB: GGPlot in Python with Plotnine</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../modules/m13/m13-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">M13 Agile</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M13_Agile/M13-01-ProjectManagement.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Project Management</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M13_Agile/M13-02-AgileDevelopment.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Agile Development</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../notebooks/M13_Agile/M13-03-UserStories.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">User Stories</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" aria-expanded="false">
 <span class="menu-text">Activities</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../activities/M01-01-Using-Rivanna.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Activity: Using Rivanna</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../activities/M01-02-Activity-GitHub.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Activity: Using Git and GitHub</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../activities/M02-01-Activity-Hello-World.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Activity: Hello, World!</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../activities/M02-02-Activity-JupyterLab-on-Rivanna.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Activity: Jupyter Lab</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-16" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-16" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../topics/oreilly-accounts.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Setting Up O’Reilly</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-is-dplyr" id="toc-what-is-dplyr" class="nav-link active" data-scroll-target="#what-is-dplyr">What is Dplyr?</a></li>
  <li><a href="#why-dplyr" id="toc-why-dplyr" class="nav-link" data-scroll-target="#why-dplyr">Why Dplyr?</a></li>
  <li><a href="#a-grammar-of-data" id="toc-a-grammar-of-data" class="nav-link" data-scroll-target="#a-grammar-of-data">A Grammar of Data</a></li>
  <li><a href="#common-function-properties" id="toc-common-function-properties" class="nav-link" data-scroll-target="#common-function-properties">Common Function Properties</a></li>
  <li><a href="#installing-dplyr" id="toc-installing-dplyr" class="nav-link" data-scroll-target="#installing-dplyr">Installing Dplyr</a></li>
  <li><a href="#getting-a-dataset" id="toc-getting-a-dataset" class="nav-link" data-scroll-target="#getting-a-dataset">Getting a dataset</a></li>
  <li><a href="#dplyr-functions-in-depth" id="toc-dplyr-functions-in-depth" class="nav-link" data-scroll-target="#dplyr-functions-in-depth">Dplyr Functions in Depth</a>
  <ul class="collapse">
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><code>select()</code></a></li>
  <li><a href="#aside-helper-functions" id="toc-aside-helper-functions" class="nav-link" data-scroll-target="#aside-helper-functions">Aside: Helper Functions</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><code>filter()</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><code>arrange()</code></a></li>
  <li><a href="#rename" id="toc-rename" class="nav-link" data-scroll-target="#rename"><code>rename()</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><code>mutate()</code></a></li>
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><code>group_by()</code></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.dev/ontoligent/DS5100-book/blob/main/notebooks/M11_RDplyr/M11-02-Dplyr.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../modules/m11/m11-intro.html">M11 Dplyr</a></li><li class="breadcrumb-item"><a href="../../notebooks/M11_RDplyr/M11-02-Dplyr.html"><span class="chapter-title">NB: Dplyr</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">NB: Dplyr</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Programming for Data Science</p>
<section id="what-is-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="what-is-dplyr">What is Dplyr?</h2>
<p>The Dplyr package is a <strong>cetnral</strong> component of the Tidyverse.</p>
<p>Technically, Dplyr is an optimized and <strong>distilled</strong> version of the previous Plyr package.</p>
<p>Plyr organizes much of the functionality of the family of <strong>apply functions in base R</strong> — functions like <code>apply()</code>, <code>lapply()</code>, <code>sapply()</code>, and <code>tapply()</code>.</p>
<p>These functions perform the <strong>same action on multiple chunks</strong> of data in a repetitive way.</p>
<p>For example, <code>apply()</code> applies a function to every element of a row or column in a dataset.</p>
</section>
<section id="why-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="why-dplyr">Why Dplyr?</h2>
<p>Dplyr was developed to provide a <strong>clean and intelligble</strong> way to process data tables.</p>
<p>It does this by providing a simple <strong>grammar</strong> for data manipulation and for operating on data frames.</p>
<p>With this grammar, you can clearly <strong>express and</strong> <strong>communicate</strong> what it is that you are doing to a data frame that other people can understand.</p>
<p>This is useful because it provides an abstraction for data manipulation that previously did not exist within R and other programming languages.</p>
<p>Another useful contribution is that the Dplyr functions are <strong>very</strong> fast, as many key operations are coded in C++.</p>
<p>Note that Dplyr does not provide any new functionality to R per se.</p>
<p>Everything Dplyr does may already be done with base R.</p>
<p>But it greatly simplifies existing functionality in R.</p>
<p>In the table below, you can see that that Dplyr provides a consistent way of phrasing the someone chaotic idioms of base R.</p>
<table class="table">
<thead>
<tr class="header">
<th>dplyr</th>
<th>base R</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>arrange(df, x)</code></td>
<td><code>df[order(x), , drop = FALSE]</code></td>
</tr>
<tr class="even">
<td><code>distinct(df, x)</code></td>
<td><code>df[!duplicated(x), , drop = FALSE], unique()</code></td>
</tr>
<tr class="odd">
<td><code>filter(df, x)</code></td>
<td><code>df[which(x), , drop = FALSE], subset()</code></td>
</tr>
<tr class="even">
<td><code>mutate(df, z = x + y)</code></td>
<td><code>df$z &lt;- df$x + df$y, transform()</code></td>
</tr>
<tr class="odd">
<td><code>pull(df, 1)</code></td>
<td><code>df[[1]]</code></td>
</tr>
<tr class="even">
<td><code>pull(df, x)</code></td>
<td><code>df$x</code></td>
</tr>
<tr class="odd">
<td><code>rename(df, y = x)</code></td>
<td><code>names(df)[names(df) == "x"] &lt;- "y"</code></td>
</tr>
<tr class="even">
<td><code>relocate(df, y)</code></td>
<td><code>df[union("y", names(df))]</code></td>
</tr>
<tr class="odd">
<td><code>select(df, x, y)</code></td>
<td><code>df[c("x", "y")], subset()</code></td>
</tr>
<tr class="even">
<td><code>select(df, starts_with("x"))</code></td>
<td><code>df[grepl("</code></td>
</tr>
<tr class="odd">
<td><code>summarise(df, mean(x))</code></td>
<td><code>mean(df$x), tapply(), aggregate(), by()</code></td>
</tr>
<tr class="even">
<td><code>slice(df, c(1, 2, 5))</code></td>
<td><code>df[c(1, 2, 5), , drop = FALSE]</code></td>
</tr>
</tbody>
</table>
</section>
<section id="a-grammar-of-data" class="level2">
<h2 class="anchored" data-anchor-id="a-grammar-of-data">A Grammar of Data</h2>
<p>Some of the key “verbs” provided by the Dplyr package are:</p>
<ul>
<li><code>select</code>: return a subset of the columns of a data frame, using a flexible notation.</li>
<li><code>filter</code>: extract a subset of rows from a data frame based on logical conditions.</li>
<li><code>arrange</code>: reorder rows of a. data frame.</li>
<li><code>rename</code>: rename variables in a data frame.</li>
<li><code>mutate</code>: add new variables/columns or transform existing variables.</li>
<li><code>summarise</code> / <code>summarize</code>: generate summary statistics of different variables in the data frame, possibly within strata.</li>
</ul>
<p><code>%&gt;%</code>: the pipe operator is used to connect multiple verb actions together into a pipeline.</p>
</section>
<section id="common-function-properties" class="level2">
<h2 class="anchored" data-anchor-id="common-function-properties">Common Function Properties</h2>
<p>All Dplyr functions have some common characteristics:</p>
<ol type="1">
<li>The <strong>first argument</strong> is a <strong>data frame</strong> (or <strong>tibble</strong>).</li>
<li>The succeeding arguments describe <strong>what to do with the data frame</strong> specified in the first argument.</li>
<li>The <strong>return</strong> result of a function is <strong>a new data frame</strong>.</li>
</ol>
<p>In addition, Dplyr expects data frames to be be <strong>properly structured</strong> as tidy data.</p>
</section>
<section id="installing-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="installing-dplyr">Installing Dplyr</h2>
<p>You can install Dplyr directly or as part of Tidyverse, which we installed in the previous notebook.</p>
<div id="a7c45fa8-599c-432b-9aa0-096821a84ba8" class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("dplyr")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the package is installed, you may load it into your R session by calling the <code>library()</code> function.</p>
<div id="95f58652-3054-4712-91f8-be872410c4c3" class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(dplyr)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Of course, you can also just install <code>tidyverse</code> if you plan to visualize your results.</p>
<p>Since we did this in our previous notebook, we can import it now.</p>
<div id="449b6987-8d3a-41b2-ab56-f834dd10bb4a" class="cell" data-tags="[]" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.4     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>You may get some warnings when the package is loaded because there are functions in the <code>dplyr</code> package that have the same name as functions in other packages. For now you can ignore the warnings.</p>
</section>
<section id="getting-a-dataset" class="level2">
<h2 class="anchored" data-anchor-id="getting-a-dataset">Getting a dataset</h2>
<p>Let’s use a dataset containing air pollution and temperature data for the <a href="http://www.biostat.jhsph.edu/~rpeng/leanpub/rprog/chicago_data.zip">city of Chicago</a> in the U.S.</p>
<p>You will find the data in the directory for this module.</p>
<p>We load the data into R using the <code>readRDS()</code> function and then convert it to a tibble.</p>
<div id="71ba5671-ba70-4e76-ac72-569acf32d804" class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"chicago.rds"</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see some basic characteristics of the dataset with the <code>print()</code> function.</p>
<div id="9ecb8993-4d2c-4833-95ff-abd93647a302" class="cell" data-tags="[]" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chicago)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,940 × 8
   city   tmpd  dptp date       pm25tmean2 pm10tmean2 o3tmean2 no2tmean2
   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;          &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
 1 chic   31.5  31.5 1987-01-01         NA       34       4.25      20.0
 2 chic   33    29.9 1987-01-02         NA       NA       3.30      23.2
 3 chic   33    27.4 1987-01-03         NA       34.2     3.33      23.8
 4 chic   29    28.6 1987-01-04         NA       47       4.38      30.4
 5 chic   32    28.9 1987-01-05         NA       NA       4.75      30.3
 6 chic   40    35.1 1987-01-06         NA       48       5.83      25.8
 7 chic   34.5  26.8 1987-01-07         NA       41       9.29      20.6
 8 chic   29    22   1987-01-08         NA       36      11.3       17.0
 9 chic   26.5  29   1987-01-09         NA       33.3     4.5       23.4
10 chic   32.5  27.8 1987-01-10         NA       NA       4.96      19.5
# ℹ 6,930 more rows</code></pre>
</div>
</div>
</section>
<section id="dplyr-functions-in-depth" class="level1">
<h1>Dplyr Functions in Depth</h1>
<p>Let’s use this tibble to explore each of the Dplyr verbs in a little more depth.</p>
<section id="select" class="level2">
<h2 class="anchored" data-anchor-id="select"><code>select()</code></h2>
<p>We use the <code>select()</code> function to <strong>select columns you want to focus on</strong>.</p>
<p>For example, we can inspect the <code>tmpd</code> column like so:</p>
<div id="eb8771ba-2aca-40b9-a2aa-82f0b2ca95d5" class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span> <span class="fu">select</span>(tmpd) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 1</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>31.5</td>
</tr>
<tr class="even">
<td>33.0</td>
</tr>
<tr class="odd">
<td>33.0</td>
</tr>
<tr class="even">
<td>29.0</td>
</tr>
<tr class="odd">
<td>32.0</td>
</tr>
<tr class="even">
<td>40.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In base R, we would do this:</p>
<div id="fc34192c-7a47-44ee-9646-3935a69ea3b3" class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chicago[<span class="st">"tmpd"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 1</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>31.5</td>
</tr>
<tr class="even">
<td>33.0</td>
</tr>
<tr class="odd">
<td>33.0</td>
</tr>
<tr class="even">
<td>29.0</td>
</tr>
<tr class="odd">
<td>32.0</td>
</tr>
<tr class="even">
<td>40.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now suppose we wanted to take the first <span class="math inline">\(3\)</span> columns only.</p>
<p>We could use numerical indices in base R.</p>
<div id="858969fa-97bc-4d5b-9bab-06fad21886c4" class="cell" data-tags="[]" data-execution_count="36">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chicago[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dewpoint</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>31.5</td>
<td>31.500</td>
</tr>
<tr class="even">
<td>chic</td>
<td>33.0</td>
<td>29.875</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>33.0</td>
<td>27.375</td>
</tr>
<tr class="even">
<td>chic</td>
<td>29.0</td>
<td>28.625</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>32.0</td>
<td>28.875</td>
</tr>
<tr class="even">
<td>chic</td>
<td>40.0</td>
<td>35.125</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In Dplr, we can use the names directly to create a column range slice:</p>
<div id="c110327d-398b-4996-8186-e9d715f80906" class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(city<span class="sc">:</span>dptp) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dptp</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>31.5</td>
<td>31.500</td>
</tr>
<tr class="even">
<td>chic</td>
<td>33.0</td>
<td>29.875</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>33.0</td>
<td>27.375</td>
</tr>
<tr class="even">
<td>chic</td>
<td>29.0</td>
<td>28.625</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>32.0</td>
<td>28.875</td>
</tr>
<tr class="even">
<td>chic</td>
<td>40.0</td>
<td>35.125</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note the use of <code>:</code> inside the <code>select()</code> — you can use it to specify a range of variable names.</p>
<p>You can also <em>omit</em> variables using the <code>select()</code> function by using <strong>the negative sign</strong>.</p>
<p>With <code>select()</code> you can do:</p>
<div id="06303e1a-98ae-4a52-be41-4f77095e7226" class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>(city<span class="sc">:</span>dptp)) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 5</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1987-01-01</td>
<td>NA</td>
<td>34.00000</td>
<td>4.250000</td>
<td>19.98810</td>
</tr>
<tr class="even">
<td>1987-01-02</td>
<td>NA</td>
<td>NA</td>
<td>3.304348</td>
<td>23.19099</td>
</tr>
<tr class="odd">
<td>1987-01-03</td>
<td>NA</td>
<td>34.16667</td>
<td>3.333333</td>
<td>23.81548</td>
</tr>
<tr class="even">
<td>1987-01-04</td>
<td>NA</td>
<td>47.00000</td>
<td>4.375000</td>
<td>30.43452</td>
</tr>
<tr class="odd">
<td>1987-01-05</td>
<td>NA</td>
<td>NA</td>
<td>4.750000</td>
<td>30.33333</td>
</tr>
<tr class="even">
<td>1987-01-06</td>
<td>NA</td>
<td>48.00000</td>
<td>5.833333</td>
<td>25.77233</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This indicates that we should include every variable <em>except</em> the variables <code>city</code> through <code>dptp</code>.</p>
<p>The <code>select()</code> function also allows a special syntax that allows you to specify <strong>variable names based on patterns</strong>.</p>
<p>If you wanted to keep every variable that ends with a “2”, we could do this:</p>
<div id="68b951a4-df02-4e85-ab63-7c90251ad425" class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">"2"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>NA</td>
<td>34.00000</td>
<td>4.250000</td>
<td>19.98810</td>
</tr>
<tr class="even">
<td>NA</td>
<td>NA</td>
<td>3.304348</td>
<td>23.19099</td>
</tr>
<tr class="odd">
<td>NA</td>
<td>34.16667</td>
<td>3.333333</td>
<td>23.81548</td>
</tr>
<tr class="even">
<td>NA</td>
<td>47.00000</td>
<td>4.375000</td>
<td>30.43452</td>
</tr>
<tr class="odd">
<td>NA</td>
<td>NA</td>
<td>4.750000</td>
<td>30.33333</td>
</tr>
<tr class="even">
<td>NA</td>
<td>48.00000</td>
<td>5.833333</td>
<td>25.77233</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Or if we wanted to keep every variable that starts with a “d”, we could do this:</p>
<div id="1068074f-1162-4214-bdde-23b644336363" class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"d"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">dptp</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>31.500</td>
<td>1987-01-01</td>
</tr>
<tr class="even">
<td>29.875</td>
<td>1987-01-02</td>
</tr>
<tr class="odd">
<td>27.375</td>
<td>1987-01-03</td>
</tr>
<tr class="even">
<td>28.625</td>
<td>1987-01-04</td>
</tr>
<tr class="odd">
<td>28.875</td>
<td>1987-01-05</td>
</tr>
<tr class="even">
<td>35.125</td>
<td>1987-01-06</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This is super useful if you have a table with prefixes, such as <code>doc_</code>.</p>
<p>You can also use more general <strong>regular expressions</strong> if necessary.</p>
</section>
<section id="aside-helper-functions" class="level2">
<h2 class="anchored" data-anchor-id="aside-helper-functions">Aside: Helper Functions</h2>
<p>Note the use of the function <code>ends_with()</code> inside of the argument space for the function <code>select()</code> above.</p>
<p><code>ends_with()</code> is an example of a “helper function” — a function that helps make Dplyr functions more effective.</p>
<p>There are many of these introduced by Dplyr.</p>
<p>Here is a set of helper functions that can be especially useful with <code>select()</code>:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 42%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th>Helper Function</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>starts_with()</code></td>
<td>Matches variable names that start with a given prefix</td>
<td><code>select(data, starts_with("X"))</code></td>
</tr>
<tr class="even">
<td><code>ends_with()</code></td>
<td>Matches variable names that end with a given suffix</td>
<td><code>select(data, ends_with("_2019"))</code></td>
</tr>
<tr class="odd">
<td><code>contains()</code></td>
<td>Matches variable names that contain a given string</td>
<td><code>select(data, contains("income"))</code></td>
</tr>
<tr class="even">
<td><code>matches()</code></td>
<td>Matches variable names that match a given regular expression</td>
<td><code>select(data, matches("^X[1-3]$"))</code></td>
</tr>
<tr class="odd">
<td><code>num_range()</code></td>
<td>Matches variable names that match a pattern of prefix + number</td>
<td><code>select(data, num_range("X", 1:3))</code></td>
</tr>
<tr class="even">
<td><code>one_of()</code></td>
<td>Matches variable names that are in a given set of names</td>
<td><code>select(data, one_of(c("var1", "var2")))</code></td>
</tr>
<tr class="odd">
<td><code>everything()</code></td>
<td>Matches all variable names (used to reorder variables)</td>
<td><code>select(data, starts_with("X"), everything())</code></td>
</tr>
</tbody>
</table>
</section>
<section id="filter" class="level2">
<h2 class="anchored" data-anchor-id="filter"><code>filter()</code></h2>
<p>The <code>filter()</code> function extracts <strong>subsets of rows</strong> from a data frame.</p>
<p>Whereas <code>select()</code> is a <strong>column-wise</strong> operation, <code>filter()</code> is <strong>row-wise</strong>.</p>
<p>This function is similar to the existing <code>subset()</code> function in R but is quite a bit faster.</p>
<p>Suppose we wanted to extract the rows of the <code>chicago</code> data frame where <strong>the levels of PM2.5 are greater than 30</strong> (which is a reasonably high level), we could do this:</p>
<div id="07bd86c3-9c5e-421c-8463-a3e3eb39720b" class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pm25tmean2 <span class="sc">&gt;</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 8</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dptp</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>23</td>
<td>21.9</td>
<td>1998-01-17</td>
<td>38.10</td>
<td>32.46154</td>
<td>3.180556</td>
<td>25.30000</td>
</tr>
<tr class="even">
<td>chic</td>
<td>28</td>
<td>25.8</td>
<td>1998-01-23</td>
<td>33.95</td>
<td>38.69231</td>
<td>1.750000</td>
<td>29.37630</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>55</td>
<td>51.3</td>
<td>1998-04-30</td>
<td>39.40</td>
<td>34.00000</td>
<td>10.786232</td>
<td>25.31310</td>
</tr>
<tr class="even">
<td>chic</td>
<td>59</td>
<td>53.7</td>
<td>1998-05-01</td>
<td>35.40</td>
<td>28.50000</td>
<td>14.295125</td>
<td>31.42905</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>57</td>
<td>52.0</td>
<td>1998-05-02</td>
<td>33.30</td>
<td>35.00000</td>
<td>20.662879</td>
<td>26.79861</td>
</tr>
<tr class="even">
<td>chic</td>
<td>57</td>
<td>56.0</td>
<td>1998-05-07</td>
<td>32.10</td>
<td>34.50000</td>
<td>24.270422</td>
<td>33.99167</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Compare this to base R:</p>
<div id="4ee2b831-8e69-491c-8e2a-a888d6b8029f" class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">na.omit</span>(chicago[(chicago<span class="sc">$</span>pm25tmean2 <span class="sc">&gt;</span> <span class="dv">30</span>),]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 8</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dptp</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>23</td>
<td>21.9</td>
<td>1998-01-17</td>
<td>38.10</td>
<td>32.46154</td>
<td>3.180556</td>
<td>25.30000</td>
</tr>
<tr class="even">
<td>chic</td>
<td>28</td>
<td>25.8</td>
<td>1998-01-23</td>
<td>33.95</td>
<td>38.69231</td>
<td>1.750000</td>
<td>29.37630</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>55</td>
<td>51.3</td>
<td>1998-04-30</td>
<td>39.40</td>
<td>34.00000</td>
<td>10.786232</td>
<td>25.31310</td>
</tr>
<tr class="even">
<td>chic</td>
<td>59</td>
<td>53.7</td>
<td>1998-05-01</td>
<td>35.40</td>
<td>28.50000</td>
<td>14.295125</td>
<td>31.42905</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>57</td>
<td>52.0</td>
<td>1998-05-02</td>
<td>33.30</td>
<td>35.00000</td>
<td>20.662879</td>
<td>26.79861</td>
</tr>
<tr class="even">
<td>chic</td>
<td>57</td>
<td>56.0</td>
<td>1998-05-07</td>
<td>32.10</td>
<td>34.50000</td>
<td>24.270422</td>
<td>33.99167</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that we have to filter out the <code>NA</code> values, which Dplyr does for you.</p>
<p>Note also that column names in Dply do not need to be prefixed by the data frame name; they are called directly.</p>
<p>For example, compare how the column <code>pm25tmean2</code> is accessed below:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span> <span class="fu">filter</span>(pm25tmean2 <span class="sc">&gt;</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>vs</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>chicago[(chicago<span class="sc">$</span>pm25tmean2 <span class="sc">&gt;</span> <span class="dv">30</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can place an arbitrarily complex logical sequence inside of <code>filter()</code>.</p>
<p>For example, we may extract the rows where PM2.5 is greater than <span class="math inline">\(30\)</span> <em>and</em> temperature is greater than <span class="math inline">\(80\)</span> degrees Fahrenheit.</p>
<div id="fca195ec-57e8-46c5-8dd6-1529dcca94e2" class="cell" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(pm25tmean2 <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">&amp;</span> tmpd <span class="sc">&gt;</span> <span class="dv">80</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(date, tmpd, pm25tmean2) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1998-08-23</td>
<td>81</td>
<td>39.6000</td>
</tr>
<tr class="even">
<td>1998-09-06</td>
<td>81</td>
<td>31.5000</td>
</tr>
<tr class="odd">
<td>2001-07-20</td>
<td>82</td>
<td>32.3000</td>
</tr>
<tr class="even">
<td>2001-08-01</td>
<td>84</td>
<td>43.7000</td>
</tr>
<tr class="odd">
<td>2001-08-08</td>
<td>85</td>
<td>38.8375</td>
</tr>
<tr class="even">
<td>2001-08-09</td>
<td>84</td>
<td>38.2000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here’s a table of helper functions specifically associated with <code>filter()</code>:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 45%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Helper Function</strong></th>
<th><strong>Description</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>between()</code></td>
<td>Check if a value lies between two other values.</td>
<td><code>filter(data, between(age, 18, 30))</code></td>
</tr>
<tr class="even">
<td><code>near()</code></td>
<td>Check for near equality (useful for floating-point numbers).</td>
<td><code>filter(data, near(price, 19.99, tolerance = 0.01))</code></td>
</tr>
<tr class="odd">
<td><code>isin()</code> (or <code>%in%</code>)</td>
<td>Check if a value is in a set of values.</td>
<td><code>filter(data, region %in% c("East", "West"))</code></td>
</tr>
<tr class="even">
<td><code>all_of()</code></td>
<td>Check for all of the variables, even if some don’t exist. Useful with character vectors.</td>
<td><code>filter(data, all_of(variables))</code></td>
</tr>
<tr class="odd">
<td><code>any_of()</code></td>
<td>Check for any of the variables. Useful with character vectors.</td>
<td><code>filter(data, any_of(variables))</code></td>
</tr>
<tr class="even">
<td><code>cur_group_id()</code></td>
<td>Identify the current group inside <code>group_by()</code>. Useful for more complex filtering with groups.</td>
<td><code>filter(data, cur_group_id() == 1)</code></td>
</tr>
</tbody>
</table>
</section>
<section id="arrange" class="level2">
<h2 class="anchored" data-anchor-id="arrange"><code>arrange()</code></h2>
<p>We use <code>arrange()</code> to <strong>reorder rows</strong> of a data frame according to one or more of the <strong>columns</strong>.</p>
<p>This normally called <strong>sorting</strong>.</p>
<p>Reordering rows of a data frame (while preserving corresponding order of other columns) is normally a pain to do in R.</p>
<p>The <code>arrange()</code> function simplifies the process quite a bit.</p>
<p>Here we order the rows of the data frame by date in ascending order:</p>
<div id="9d7938a9-c5f8-49d8-8699-c2c156afddb4" class="cell" data-tags="[]" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>chicago_by_date <span class="ot">&lt;-</span> chicago <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(date)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>chicago_by_date <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 8</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dptp</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>31.5</td>
<td>31.500</td>
<td>1987-01-01</td>
<td>NA</td>
<td>34.00000</td>
<td>4.250000</td>
<td>19.98810</td>
</tr>
<tr class="even">
<td>chic</td>
<td>33.0</td>
<td>29.875</td>
<td>1987-01-02</td>
<td>NA</td>
<td>NA</td>
<td>3.304348</td>
<td>23.19099</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>33.0</td>
<td>27.375</td>
<td>1987-01-03</td>
<td>NA</td>
<td>34.16667</td>
<td>3.333333</td>
<td>23.81548</td>
</tr>
<tr class="even">
<td>chic</td>
<td>29.0</td>
<td>28.625</td>
<td>1987-01-04</td>
<td>NA</td>
<td>47.00000</td>
<td>4.375000</td>
<td>30.43452</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>32.0</td>
<td>28.875</td>
<td>1987-01-05</td>
<td>NA</td>
<td>NA</td>
<td>4.750000</td>
<td>30.33333</td>
</tr>
<tr class="even">
<td>chic</td>
<td>40.0</td>
<td>35.125</td>
<td>1987-01-06</td>
<td>NA</td>
<td>48.00000</td>
<td>5.833333</td>
<td>25.77233</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can now check the first few rows</p>
<div id="b3f4e3a6-6be0-49d2-ba03-9fcfc72254c4" class="cell" data-tags="[]" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>chicago_by_date <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, pm25tmean2) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 3 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1987-01-01</td>
<td>NA</td>
</tr>
<tr class="even">
<td>1987-01-02</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>1987-01-03</td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>and the last few rows.</p>
<div id="34cdea90-60c0-43be-acf6-c17af8ef9751" class="cell" data-tags="[]" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>chicago_by_date <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, pm25tmean2) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 3 × 2</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2005-12-29</td>
<td>7.45000</td>
</tr>
<tr class="even">
<td>2005-12-30</td>
<td>15.05714</td>
</tr>
<tr class="odd">
<td>2005-12-31</td>
<td>15.00000</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Columns can be arranged in descending order too by using the <code>desc()</code> helper function.</p>
<div id="a4aa12e7-3fc1-4d36-bbb7-40d6c6664884" class="cell" data-tags="[]" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 8</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dptp</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>35</td>
<td>30.1</td>
<td>2005-12-31</td>
<td>15.00000</td>
<td>23.5</td>
<td>2.531250</td>
<td>13.25000</td>
</tr>
<tr class="even">
<td>chic</td>
<td>36</td>
<td>31.0</td>
<td>2005-12-30</td>
<td>15.05714</td>
<td>19.2</td>
<td>3.034420</td>
<td>22.80556</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>35</td>
<td>29.4</td>
<td>2005-12-29</td>
<td>7.45000</td>
<td>23.5</td>
<td>6.794837</td>
<td>19.97222</td>
</tr>
<tr class="even">
<td>chic</td>
<td>37</td>
<td>34.5</td>
<td>2005-12-28</td>
<td>17.75000</td>
<td>27.5</td>
<td>3.260417</td>
<td>19.28563</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>40</td>
<td>33.6</td>
<td>2005-12-27</td>
<td>23.56000</td>
<td>27.0</td>
<td>4.468750</td>
<td>23.50000</td>
</tr>
<tr class="even">
<td>chic</td>
<td>35</td>
<td>29.6</td>
<td>2005-12-26</td>
<td>8.40000</td>
<td>8.5</td>
<td>14.041667</td>
<td>16.81944</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here’s a table of helper functions specifically associated with <code>arrange()</code>:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 47%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Helper Function</strong></th>
<th><strong>Description</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>desc()</code></td>
<td>Order by descending instead of default ascending.</td>
<td><code>arrange(data, desc(salary))</code></td>
</tr>
<tr class="even">
<td><code>across()</code></td>
<td>Apply to multiple columns, especially with <code>c_across()</code> in <code>dplyr</code> 1.0.0 and later.</td>
<td><code>arrange(data, across(starts_with("X")))</code></td>
</tr>
<tr class="odd">
<td><code>row_number()</code></td>
<td>Create an index based on the order of rows.</td>
<td><code>mutate(data, idx = row_number())</code></td>
</tr>
</tbody>
</table>
<p>Note that <code>row_number()</code> is often seen in <code>mutate()</code> for creating an index column based on ordering.</p>
<p>The <code>across()</code> function provides a more concise syntax for working with multiple columns.</p>
<p>It is useful in <code>arrange()</code> when you’re trying to order rows based on a selection of columns that match a certain criterion.</p>
<p>Most of the magic with <code>arrange()</code> happens through the way you structure its arguments and not necessarily through a large set of helper functions.</p>
</section>
<section id="rename" class="level2">
<h2 class="anchored" data-anchor-id="rename"><code>rename()</code></h2>
<p>Renaming a variable in a data frame in R is surprisingly hard to do!</p>
<p>The <code>rename()</code> function is designed to make this process easier.</p>
<p>Here we select the names of the first five variables in the <code>chicago</code> data frame.</p>
<div id="f282bc64-481f-410e-a1d2-2f2351452111" class="cell" data-tags="[]" data-execution_count="23">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 3 × 5</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dptp</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>31.5</td>
<td>31.500</td>
<td>1987-01-01</td>
<td>NA</td>
</tr>
<tr class="even">
<td>chic</td>
<td>33.0</td>
<td>29.875</td>
<td>1987-01-02</td>
<td>NA</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>33.0</td>
<td>27.375</td>
<td>1987-01-03</td>
<td>NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>dptp</code> column represents the dew point temperature and the <code>pm25tmean2</code> column the PM2.5 data.</p>
<p>These names are cryptic, so let’s rename them.</p>
<div id="0c870358-cadc-451f-9c6b-dbb745e9fcff" class="cell" data-tags="[]" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="ot">&lt;-</span> chicago <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">dewpoint =</span> dptp, <span class="at">pm25 =</span> pm25tmean2) </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span>  </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 3 × 8</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dewpoint</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>31.5</td>
<td>31.500</td>
<td>1987-01-01</td>
<td>NA</td>
<td>34.00000</td>
<td>4.250000</td>
<td>19.98810</td>
</tr>
<tr class="even">
<td>chic</td>
<td>33.0</td>
<td>29.875</td>
<td>1987-01-02</td>
<td>NA</td>
<td>NA</td>
<td>3.304348</td>
<td>23.19099</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>33.0</td>
<td>27.375</td>
<td>1987-01-03</td>
<td>NA</td>
<td>34.16667</td>
<td>3.333333</td>
<td>23.81548</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The syntax inside the <code>rename()</code> function is to have the new name on the left-hand side of the <code>=</code> sign and the old name on the right-hand side.</p>
<p>Here’s a table of helper functions that can be used with <code>rename()</code>:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Helper Function</strong></th>
<th><strong>Description</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>starts_with()</code></td>
<td>Match columns that start with a given prefix.</td>
<td><code>rename(data, start_X = starts_with("X"))</code> (Note: This example would rename the first column that starts with “X” to “start_X”)</td>
</tr>
<tr class="even">
<td><code>ends_with()</code></td>
<td>Match columns that end with a given suffix.</td>
<td><code>rename(data, end_year = ends_with("_2021"))</code></td>
</tr>
<tr class="odd">
<td><code>contains()</code></td>
<td>Match columns that contain a given string.</td>
<td><code>rename(data, has_rate = contains("rate"))</code></td>
</tr>
<tr class="even">
<td><code>matches()</code></td>
<td>Match columns that match a given regular expression.</td>
<td><code>rename(data, match_num = matches("^X[1-3]$"))</code></td>
</tr>
<tr class="odd">
<td><code>everything()</code></td>
<td>Match all columns.</td>
<td>Rarely used with <code>rename()</code>, but possible.</td>
</tr>
</tbody>
</table>
<p>It’s worth noting that these helper functions will typically target the first column that meets the specified criterion.</p>
<p>If there are multiple columns that match the criterion (e.g., multiple columns that start with “X”), you’ll need to use these helpers with more precision or utilize other techniques.</p>
<p>Also, remember to always refer to the official Dplyr documentation as the package continues to evolve and new functionalities might be added over time.</p>
</section>
<section id="mutate" class="level2">
<h2 class="anchored" data-anchor-id="mutate"><code>mutate()</code></h2>
<p>The <code>mutate()</code> function creates <strong>new columns</strong> based on computations usually involving the other columns.</p>
<p>For example, with air pollution data, we often want to <strong>de-trend</strong> the data by subtracting the mean from the data.</p>
<p>This allows us to see whether a given day’s air pollution level is higher than or less than average.</p>
<p>Here we create a <code>pm25detrend</code> variable that subtracts the mean from the <code>pm25</code> variable.</p>
<p>We also compute the Z-score.</p>
<div id="eac2896e-a3cf-4b9d-a878-b1f536b466f7" class="cell" data-tags="[]" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="ot">&lt;-</span> chicago <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">pm25detrend =</span> pm25 <span class="sc">-</span> <span class="fu">mean</span>(pm25, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">pm25z =</span> pm25detrend <span class="sc">/</span> <span class="fu">sd</span>(pm25, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span> <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 10</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">city</th>
<th data-quarto-table-cell-role="th" scope="col">tmpd</th>
<th data-quarto-table-cell-role="th" scope="col">dewpoint</th>
<th data-quarto-table-cell-role="th" scope="col">date</th>
<th data-quarto-table-cell-role="th" scope="col">pm25</th>
<th data-quarto-table-cell-role="th" scope="col">pm10tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">o3tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">no2tmean2</th>
<th data-quarto-table-cell-role="th" scope="col">pm25detrend</th>
<th data-quarto-table-cell-role="th" scope="col">pm25z</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;chr&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;date&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>chic</td>
<td>35</td>
<td>29.6</td>
<td>2005-12-26</td>
<td>8.40000</td>
<td>8.5</td>
<td>14.041667</td>
<td>16.81944</td>
<td>-7.830958</td>
<td>-0.9003429</td>
</tr>
<tr class="even">
<td>chic</td>
<td>40</td>
<td>33.6</td>
<td>2005-12-27</td>
<td>23.56000</td>
<td>27.0</td>
<td>4.468750</td>
<td>23.50000</td>
<td>7.329042</td>
<td>0.8426366</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>37</td>
<td>34.5</td>
<td>2005-12-28</td>
<td>17.75000</td>
<td>27.5</td>
<td>3.260417</td>
<td>19.28563</td>
<td>1.519042</td>
<td>0.1746477</td>
</tr>
<tr class="even">
<td>chic</td>
<td>35</td>
<td>29.4</td>
<td>2005-12-29</td>
<td>7.45000</td>
<td>23.5</td>
<td>6.794837</td>
<td>19.97222</td>
<td>-8.780958</td>
<td>-1.0095666</td>
</tr>
<tr class="odd">
<td>chic</td>
<td>36</td>
<td>31.0</td>
<td>2005-12-30</td>
<td>15.05714</td>
<td>19.2</td>
<td>3.034420</td>
<td>22.80556</td>
<td>-1.173815</td>
<td>-0.1349561</td>
</tr>
<tr class="even">
<td>chic</td>
<td>35</td>
<td>30.1</td>
<td>2005-12-31</td>
<td>15.00000</td>
<td>23.5</td>
<td>2.531250</td>
<td>13.25000</td>
<td>-1.230958</td>
<td>-0.1415260</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note how the new column name <code>pm25detrend</code> can be used immediately within the argument space of <code>mutate()</code>.</p>
<p>Dplyr also has a related <code>transmute()</code> function.</p>
<p>It does the same thing as <code>mutate()</code> but then <strong><em>drops all non-transformed variables</em></strong>.</p>
<p>Here we de-trend the PM10 and ozone (O3) variables.</p>
<div id="0774ad08-80eb-4344-928f-63e10d1bc814" class="cell" data-tags="[]" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>chicago_detrended <span class="ot">&lt;-</span> chicago <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">pm10detrend =</span> pm10tmean2 <span class="sc">-</span> <span class="fu">mean</span>(pm10tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">o3detrend =</span> o3tmean2 <span class="sc">-</span> <span class="fu">mean</span>(o3tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">o3z =</span> o3detrend <span class="sc">/</span> <span class="fu">sd</span>(o3tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>chicago_detrended <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">pm10detrend</th>
<th data-quarto-table-cell-role="th" scope="col">o3detrend</th>
<th data-quarto-table-cell-role="th" scope="col">o3z</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.1047939</td>
<td>-15.18551</td>
<td>-1.333702</td>
</tr>
<tr class="even">
<td>NA</td>
<td>-16.13117</td>
<td>-1.416756</td>
</tr>
<tr class="odd">
<td>0.2714605</td>
<td>-16.10218</td>
<td>-1.414211</td>
</tr>
<tr class="even">
<td>13.1047939</td>
<td>-15.06051</td>
<td>-1.322724</td>
</tr>
<tr class="odd">
<td>NA</td>
<td>-14.68551</td>
<td>-1.289789</td>
</tr>
<tr class="even">
<td>14.1047939</td>
<td>-13.60218</td>
<td>-1.194642</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Note that there are only three columns in the transmuted data frame.</p>
<p>Here’s a table of helper functions specifically associated with <code>mutate()</code>:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 31%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Helper Function</strong></th>
<th><strong>Description</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>if_else()</code></td>
<td>A vectorized conditional operation (if-else).</td>
<td><code>mutate(data, status = if_else(age &lt; 18, "minor", "adult"))</code></td>
</tr>
<tr class="even">
<td><code>case_when()</code></td>
<td>Generalized multiple conditions for transformations.</td>
<td><code>mutate(data, category = case_when(score &gt; 90 ~ "A", score &gt; 80 ~ "B", TRUE ~ "C"))</code></td>
</tr>
<tr class="odd">
<td><code>lead()</code></td>
<td>Access the subsequent value in the column.</td>
<td><code>mutate(data, next_value = lead(column_name))</code></td>
</tr>
<tr class="even">
<td><code>lag()</code></td>
<td>Access the preceding value in the column.</td>
<td><code>mutate(data, previous_value = lag(column_name))</code></td>
</tr>
<tr class="odd">
<td><code>row_number()</code></td>
<td>Generate row numbers, often used with <code>arrange()</code>.</td>
<td><code>mutate(data, rank = row_number())</code></td>
</tr>
<tr class="even">
<td><code>rank()</code>, <code>min_rank()</code>, <code>dense_rank()</code></td>
<td>Different types of ranking functions.</td>
<td><code>mutate(data, rank = rank(score))</code></td>
</tr>
<tr class="odd">
<td><code>cumsum()</code>, <code>cumprod()</code>, <code>cummin()</code>, <code>cummax()</code></td>
<td>Cumulative functions.</td>
<td><code>mutate(data, cumulative_total = cumsum(total))</code></td>
</tr>
<tr class="even">
<td><code>coalesce()</code></td>
<td>Return the first non-missing value among its arguments.</td>
<td><code>mutate(data, combined = coalesce(col1, col2))</code></td>
</tr>
<tr class="odd">
<td><code>na_if()</code></td>
<td>Replace a specified value with NA.</td>
<td><code>mutate(data, updated_col = na_if(column_name, "replace_me"))</code></td>
</tr>
<tr class="even">
<td><code>replace_na()</code></td>
<td>Replace NA values with a specified value.</td>
<td><code>mutate(data, updated_col = replace_na(column_name, "new_value"))</code></td>
</tr>
<tr class="odd">
<td><code>recode()</code></td>
<td>Recode or replace values in a column.</td>
<td><code>mutate(data, recoded_col = recode(column_name, old="new", ...))</code></td>
</tr>
<tr class="even">
<td><code>across()</code></td>
<td>Apply a function across multiple columns (from <code>dplyr</code> 1.0.0).</td>
<td><code>mutate(data, across(c(col1, col2), function_name))</code></td>
</tr>
</tbody>
</table>
</section>
<section id="group_by" class="level2">
<h2 class="anchored" data-anchor-id="group_by"><code>group_by()</code></h2>
<p>The <code>group_by()</code> function is used to generate <strong>summary or aggregate statistics</strong> from a data frame.</p>
<p>In conjunction with the <code>group_by()</code> function we often use the <code>summarize()</code> function.</p>
<p>The general operation here is a combination of:</p>
<ul>
<li><strong>splitting</strong> a table into separate pieces defined by a variable or group of variables (<code>group_by()</code>),</li>
<li>then <strong>applying</strong> a summary function across those subsets (<code>summarize()</code>),</li>
<li>then <strong>combining</strong> back into another table.</li>
</ul>
<p>This pattern is called <strong>split, apply, and combine</strong>.</p>
<p>It is a fundamental pattern in data processing.</p>
<p>For example, in this air pollution dataset, you might want to know the <strong>average annual level of PM2.5</strong>.</p>
<p>The stratum is the <strong>year</strong>, which we can derive from the <code>date</code> variable.</p>
<p>First, we can create a <code>year</code> variable using <code>as.POSIXlt()</code>.</p>
<p>Then we group on our new column and compute summary statistics for each year with the <code>summarize()</code> function.</p>
<div id="72d710d1-c794-40ff-b6c8-d8bc843b5ffc" class="cell" data-tags="[]" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> chicago <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.POSIXlt</span>(date)<span class="sc">$</span>year <span class="sc">+</span> <span class="dv">1900</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pm25 =</span> <span class="fu">mean</span>(pm25, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">o3 =</span> <span class="fu">max</span>(o3tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">no2 =</span> <span class="fu">median</span>(no2tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>years <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">year</th>
<th data-quarto-table-cell-role="th" scope="col">pm25</th>
<th data-quarto-table-cell-role="th" scope="col">o3</th>
<th data-quarto-table-cell-role="th" scope="col">no2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1987</td>
<td>NaN</td>
<td>62.96966</td>
<td>23.49369</td>
</tr>
<tr class="even">
<td>1988</td>
<td>NaN</td>
<td>61.67708</td>
<td>24.52296</td>
</tr>
<tr class="odd">
<td>1989</td>
<td>NaN</td>
<td>59.72727</td>
<td>26.14062</td>
</tr>
<tr class="even">
<td>1990</td>
<td>NaN</td>
<td>52.22917</td>
<td>22.59583</td>
</tr>
<tr class="odd">
<td>1991</td>
<td>NaN</td>
<td>63.10417</td>
<td>21.38194</td>
</tr>
<tr class="even">
<td>1992</td>
<td>NaN</td>
<td>50.82870</td>
<td>24.78921</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>To see why we add <span class="math inline">\(1900\)</span> in the preceding mutation, note that the date function returns just the last two digits of the year.</p>
<div id="72e37fed-73eb-4ce5-977f-66c764ad49be" class="cell" data-tags="[]" data-execution_count="28">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.POSIXlt</span>(chicago<span class="sc">$</span>date)<span class="sc">$</span>year <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>87</li><li>87</li><li>87</li><li>87</li><li>87</li><li>87</li></ol>
</div>
</div>
<p>Note in the process, we implicitly created a separate data frame that splits the original data frame by year, which is then passed to <code>summarize()</code>.</p>
<p><code>summarize()</code> then returns a data frame with columns for <code>year</code> and the annual averages of <code>pm25</code>, <code>o3</code>, and <code>no2</code>.</p>
<p>In a slightly more complicated example, we might want to know what are the average levels of ozone <code>o3</code> and nitrogen dioxide <code>no2</code> within quantiles of <code>pm25</code>.</p>
<p>We could do this with a regression model, but we can also do this quickly with <code>group_by()</code> and <code>summarize()</code>.</p>
<p>First, we can create a categorical variable of <code>pm25</code> divided into quantiles.</p>
<div id="57fe034f-1e99-4ca8-a53a-3ce149974d0a" class="cell" data-tags="[]" data-execution_count="29">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>qq <span class="ot">&lt;-</span> <span class="fu">quantile</span>(chicago<span class="sc">$</span>pm25, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(qq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0%    20%    40%    60%    80%   100% 
 1.700  8.700 12.375 16.700 22.610 61.500 </code></pre>
</div>
</div>
<p>Then we group the data frame by the <code>pm25.quint</code> variable and compute the mean of <code>o3</code> and <code>no2</code> within quantiles of <code>pm25</code>.</p>
<div id="7f29dc70-af72-41c1-ba16-294320090610" class="cell" data-tags="[]" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm25.quint =</span> <span class="fu">cut</span>(pm25, qq)) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pm25.quint) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">o3 =</span> <span class="fu">mean</span>(o3tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">no2 =</span> <span class="fu">mean</span>(no2tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">.groups =</span> <span class="st">"drop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 6 × 3</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">pm25.quint</th>
<th data-quarto-table-cell-role="th" scope="col">o3</th>
<th data-quarto-table-cell-role="th" scope="col">no2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;fct&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(1.7,8.7]</td>
<td>21.66401</td>
<td>17.99129</td>
</tr>
<tr class="even">
<td>(8.7,12.4]</td>
<td>20.38248</td>
<td>22.13004</td>
</tr>
<tr class="odd">
<td>(12.4,16.7]</td>
<td>20.66160</td>
<td>24.35708</td>
</tr>
<tr class="even">
<td>(16.7,22.6]</td>
<td>19.88122</td>
<td>27.27132</td>
</tr>
<tr class="odd">
<td>(22.6,61.5]</td>
<td>20.31775</td>
<td>29.64427</td>
</tr>
<tr class="even">
<td>NA</td>
<td>18.79044</td>
<td>25.77585</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>From the table, it seems there isn’t a strong relationship between <code>pm25</code> and <code>o3</code>, but there appears to be a positive correlation between <code>pm25</code> and <code>no2</code>.</p>
<p>More sophisticated statistical modeling can help to provide precise answers to these questions, but a simple application of Dplyr functions can often get you most of the way there.</p>
<p>Here is another example:</p>
<div id="2a436a25-323d-4870-b49e-a767f9b457fa" class="cell" data-tags="[]" data-execution_count="31">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>chicago <span class="sc">%&gt;%</span>  </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">as.POSIXlt</span>(date)<span class="sc">$</span>mon <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">%&gt;%</span>                              <span class="co"># SPLIT</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pm25 =</span> <span class="fu">mean</span>(pm25, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),       <span class="co"># APPLY </span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">o3 =</span> <span class="fu">max</span>(o3tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">no2 =</span> <span class="fu">median</span>(no2tmean2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>) </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                                                    <span class="co"># COMBINE (in the result)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A tibble: 12 × 4</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" scope="col">month</th>
<th data-quarto-table-cell-role="th" scope="col">pm25</th>
<th data-quarto-table-cell-role="th" scope="col">o3</th>
<th data-quarto-table-cell-role="th" scope="col">no2</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>17.76996</td>
<td>28.22222</td>
<td>25.35417</td>
</tr>
<tr class="even">
<td>2</td>
<td>20.37513</td>
<td>37.37500</td>
<td>26.78034</td>
</tr>
<tr class="odd">
<td>3</td>
<td>17.40818</td>
<td>39.05000</td>
<td>26.76984</td>
</tr>
<tr class="even">
<td>4</td>
<td>13.85879</td>
<td>47.94907</td>
<td>25.03125</td>
</tr>
<tr class="odd">
<td>5</td>
<td>14.07420</td>
<td>52.75000</td>
<td>24.22222</td>
</tr>
<tr class="even">
<td>6</td>
<td>15.86461</td>
<td>66.58750</td>
<td>25.01140</td>
</tr>
<tr class="odd">
<td>7</td>
<td>16.57087</td>
<td>59.54167</td>
<td>22.38442</td>
</tr>
<tr class="even">
<td>8</td>
<td>16.93380</td>
<td>53.96701</td>
<td>22.98333</td>
</tr>
<tr class="odd">
<td>9</td>
<td>15.91279</td>
<td>57.48864</td>
<td>24.47917</td>
</tr>
<tr class="even">
<td>10</td>
<td>14.23557</td>
<td>47.09275</td>
<td>24.15217</td>
</tr>
<tr class="odd">
<td>11</td>
<td>15.15794</td>
<td>29.45833</td>
<td>23.56537</td>
</tr>
<tr class="even">
<td>12</td>
<td>17.52221</td>
<td>27.70833</td>
<td>24.45773</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Here’s a table of helper functions specifically associated with <code>group_by()</code>:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 43%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Helper Function</strong></th>
<th><strong>Description</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>add_tally()</code></td>
<td>Adds a column with the count of each group (equivalent to adding a count with <code>mutate()</code> after a <code>group_by()</code>).</td>
<td><code>group_by(data, group_var) %&gt;% add_tally()</code></td>
</tr>
<tr class="even">
<td><code>group_size()</code></td>
<td>Returns the size of each group.</td>
<td><code>group_by(data, group_var) %&gt;% summarise(size = group_size())</code></td>
</tr>
<tr class="odd">
<td><code>ntile()</code></td>
<td>Creates rank percentiles within groups.</td>
<td><code>group_by(data, group_var) %&gt;% mutate(perc = ntile(score, 4))</code></td>
</tr>
<tr class="even">
<td><code>cur_group_id()</code></td>
<td>Gives an integer identifier for the current group.</td>
<td><code>group_by(data, group_var) %&gt;% filter(cur_group_id() == 1)</code></td>
</tr>
<tr class="odd">
<td><code>cur_group_rows()</code></td>
<td>Provides row indices for the current group.</td>
<td>Used internally, but can be useful for advanced operations.</td>
</tr>
<tr class="even">
<td><code>group_map()</code>, <code>group_modify()</code>, <code>group_walk()</code></td>
<td>Functions to iterate over groups, modify them or walk them with side effects.</td>
<td><code>group_map(data, ~ head(.x, 2))</code> shows the first two rows of each group.</td>
</tr>
</tbody>
</table>
<p>It’s worth noting that <code>group_by()</code> often works in tandem with other verbs, so the real power comes from the combined operations.</p>
<p>For example, after grouping data, one often uses <code>summarise()</code> to calculate summary statistics for each group.</p>
<p>The combination of these functions and their associated helpers allow for a wide range of group-wise data manipulation tasks.</p>
<p>Based on <a href="https://bookdown.org/rdpeng/rprogdatascience/">Peng 2022</a></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../notebooks/M11_RDplyr/M11-01-Tibbles.html" class="pagination-link" aria-label="NB: The Tidyverse and Tibbles">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">NB: The Tidyverse and Tibbles</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../modules/m12/m12-intro.html" class="pagination-link" aria-label="M12 Visualization">
        <span class="nav-page-text">M12 Visualization</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.dev/ontoligent/DS5100-book/blob/main/notebooks/M11_RDplyr/M11-02-Dplyr.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Copyright © 2025, Rafael C. Alvarado</p>
</div>
  </div>
</footer>




</body></html>